<% include partials/head %>

<% include partials/menu %>

<div class="container mt-5 mb-5">


  <div class="row">

    <div class="col-md-4">
      <div class="alert alert-light" role="alert">
        A simple primary alertâ€”check it out!
      </div>
    </div>

    <div class="col-md-8">
      <h2><i class="fas fa-bell"></i> Notifications</h2>
      <div class="list-group" id="list-notifications"></div>

      <ul class="pagination mt-3">
        <li class="page-item"><a class="page-link" href="#" id="btn-previous">Previous</a></li>
        <li class="page-item"><a class="page-link" href="#" id="pages">1</a></li>
        <li class="page-item"><a class="page-link" href="#" id="btn-next">Next</a></li>
      </ul>

    </div>

  </div>

</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {

    var listNotifications = [];
    let step = 5;
    let end = step;
    let start = 0;

    // https://gestion-park.herokuapp.com/notifications/unread
    // http://localhost:3000/notifications/read
    fetch("https://gestion-park.herokuapp.com/notifications/read")
      .then(res => res.json())
      .then(data => pagination(data))
      .catch(err => console.log(err));


    function pagination(data) {

      const listNotifs = document.getElementById("list-notifications");
      const btnNext = document.getElementById("btn-next");
      const btnPrev = document.getElementById("btn-previous");
      const pages = document.getElementById("pages");
      let i = 1;      


      if (data && data.length > 0) {

        const len = data.length;
        data = data.reverse();
        listNotifications = data.slice(0, 5);
        displayList(listNotifications, start, end);

        btnNext.onclick = () => {
          
          if (end < len - 1) {
            i++;
            pages.innerHTML = i + " ";            
            start += 5;
            end += 5;
            listNotifications = data.slice(start, end);
            displayList(listNotifications, start, end);
          }

        }

        btnPrev.onclick = () => {

          if (start > 0) {
            i--;
            pages.innerHTML = i + " ";            
            start -= 5;
            end -= 5;
            listNotifications = data.slice(start, end);
            displayList(listNotifications, start, end);
          }

        }

        function displayList(listNotifications, start, end) {
          listNotifs.innerHTML = "";
          for (let d of listNotifications) {

            listNotifs.innerHTML += `
                
              <a href="/reservations/list-demands" 
              class="list-group-item list-group-item-action scale-in-tl">
                <i class="fas fa-bookmark mr-3"></i> ${d.message}
                <span class="badge badge-info" style="float:right">
                    ${d.date_notif}
                </span>
              </a>
            `;
          }
        }


      }
    }


  });
</script>

<% include partials/footer %>